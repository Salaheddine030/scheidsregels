<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>RefConnect ‚Äì Quiz</title>
<meta name="theme-color" content="#0b1220">
<style>
  /* ====== Basis (geen horizontale verschuiving) ====== */
  *,*::before,*::after{ box-sizing:border-box; min-width:0 }
  html,body{
    margin:0; padding:0; width:100%;
    background:#0b1220; color:#e5e7eb;
    font-family:-apple-system,system-ui,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    -webkit-text-size-adjust:100%; text-size-adjust:100%;
    overflow-x:hidden; /* cruciaal op iOS */
  }
  a{ color:inherit; text-decoration:none }

  /* ====== Theme tokens (dark by default) ====== */
  :root{
    --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
    --border:#1f2937; --accent:#60a5fa; --accent2:#34d399;
    --ok:#22c55e; --bad:#ef4444; --warn:#fbbf24;
    --radius:16px; --shadow:0 8px 26px rgba(0,0,0,.35);
  }
  body.light{
    --bg:#f7fafc; --panel:#ffffff; --text:#0f172a; --muted:#64748b;
    --border:#e2e8f0; --accent:#2563eb; --accent2:#22c55e;
    --shadow:0 8px 26px rgba(2,6,23,.08);
  }
  body{ background:var(--bg); color:var(--text) }

  /* ====== Header ====== */
  .header{
    position:sticky; top:0; z-index:20;
    background:var(--panel); border-bottom:1px solid var(--border);
  }
  .h-row{ max-width:980px; margin:0 auto; padding:10px 12px;
    display:flex; align-items:center; justify-content:space-between; gap:10px }
  .brand{ display:flex; align-items:center; gap:10px }
  .badge{ width:42px; height:42px; border-radius:12px; display:grid; place-items:center;
    font-weight:900; color:#0b1220; background:radial-gradient(circle at 30% 30%, #93c5fd, var(--accent)) }
  .btitle{ font-weight:900 }
  .bsub{ color:var(--muted); font-size:.85em }
  .theme{ display:flex; gap:6px }
  .btn{
    appearance:none; border:1px solid var(--border); background:var(--panel); color:var(--text);
    padding:9px 12px; border-radius:12px; font-weight:800; cursor:pointer; box-shadow:var(--shadow)
  }

  /* ====== Layout ====== */
  .container{ max-width:980px; margin:0 auto; padding:12px; }
  .grid{ display:grid; gap:12px }
  @media (min-width:980px){ .grid-2{ grid-template-columns:1.2fr .9fr } }
  .card{ background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:12px; box-shadow:var(--shadow) }
  .h2{ margin:0 0 6px; font-size:1.15em; font-weight:900 }
  .muted{ color:var(--muted) }
  input[type=file]{ display:none }
  .input,.select,.textarea{ width:100%; background:var(--panel); border:1px solid var(--border); color:var(--text); border-radius:12px; padding:10px; font-size:16px }
  .toolbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center }

  /* ====== Quiz UI ====== */
  .topline{ display:flex; align-items:center; justify-content:space-between; gap:10px; color:var(--muted) }
  .progress{ width:100%; height:10px; border:1px solid var(--border); border-radius:999px; background:rgba(148,163,184,.12); overflow:hidden }
  .fill{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .25s }

  /* Lange tekst: altijd netjes afbreken, nooit naar rechts uitrekken */
  .q-text{
    font-size:1.12em; font-weight:900; margin:10px 0;
    white-space:normal; word-break:normal; overflow-wrap:anywhere; hyphens:auto;
  }
  .options{ display:grid; gap:10px }
  .option{
    display:flex; align-items:flex-start; gap:10px; padding:12px; border-radius:12px;
    border:1.5px solid var(--border); background:var(--panel); cursor:pointer;
    min-height:56px;
  }
  .opt-bullet{ flex:0 0 26px; width:26px; height:26px; border-radius:50%; border:2px solid #334155; color:#cbd5e1; display:grid; place-items:center; font-weight:900; background:#0b1220 }
  .opt-text{
    white-space:normal; word-break:normal; overflow-wrap:anywhere; hyphens:auto;
  }

  /* Geen layout-shift bij checken: alleen kleur van border/achtergrond, geen dikte */
  .option.selected{ border-color:#93c5fd; background:rgba(147,197,253,.10) }
  .option.correct{ border-color:#86efac; background:rgba(134,239,172,.12) }
  .option.wrong{ border-color:#fecaca; background:rgba(254,202,202,.12) }

  /* Feedback-balk heeft vaste minimale hoogte zodat de layout niet springt */
  .result{
    margin-top:10px; border:1px solid var(--border); border-radius:12px; padding:10px; background:var(--panel);
    min-height:56px; display:flex; align-items:center; justify-content:space-between; gap:8px;
  }
  .result-title{ font-weight:900 }
  .result-detail{ color:var(--muted) }

  .sticky{
    position:sticky; bottom:8px; margin-top:10px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
    border:1px solid var(--border); border-radius:12px; padding:8px; background:rgba(15,23,42,.75); backdrop-filter:blur(6px)
  }
  .grow{ flex:1 }
  .chipbox{ display:flex; gap:8px; overflow:auto; padding-bottom:4px }
  .chip{ padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:var(--panel); cursor:pointer; white-space:nowrap }
  .chip.active{ background:rgba(147,197,253,.12); border-color:#334155 }
</style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="h-row">
      <div class="brand">
        <div class="badge">RC</div>
        <div><div class="btitle">RefConnect</div><div class="bsub">Quiz</div></div>
      </div>
      <div class="theme">
        <button id="light" class="btn" aria-pressed="false">‚òÄÔ∏è</button>
        <button id="dark"  class="btn" aria-pressed="true">üåô</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="grid grid-2">
      <!-- Quiz -->
      <section class="card">
        <div class="topline">
          <div id="progressLabel">Vraag 0/0</div>
          <div id="tagLabel" class="muted"></div>
        </div>
        <div class="progress" aria-hidden="true"><div id="fill" class="fill"></div></div>

        <div id="qText" class="q-text">‚Äî</div>
        <div id="optList" class="options"></div>

        <div class="result" aria-live="polite">
          <div>
            <div id="resTitle" class="result-title"></div>
            <div id="resDetail" class="result-detail"></div>
          </div>
          <button id="btnExplain" class="btn" style="display:none">Toelichting</button>
        </div>

        <div class="sticky">
          <div id="status" class="muted grow">Status: nog geen vragen geladen.</div>
          <button id="btnPracticeWrong" class="btn" disabled>Fouten oefenen</button>
          <button id="btnCheck" class="btn" disabled>Nakijken</button>
          <button id="btnNext" class="btn" disabled>Volgende</button>
        </div>
      </section>

      <!-- Dataset/filters -->
      <aside class="card">
        <div class="h2">Dataset</div>
        <div class="toolbar" style="margin-bottom:6px">
          <label class="btn" for="fileJSON">üì• Importeer JSON</label>
          <input id="fileJSON" type="file" accept=".json,application/json">
          <button id="btnPaste" class="btn">üìã Plak JSON</button>
          <button id="btnResetScore" class="btn">üîÑ Reset score</button>
        </div>

        <div class="h2">Zoeken</div>
        <input id="search" class="input" placeholder="Zoek in vraag of opties‚Ä¶">

        <div class="h2" style="margin-top:10px">Filter op tag</div>
        <div id="chipBox" class="chipbox"></div>

        <div class="h2" style="margin-top:10px">Volgorde</div>
        <select id="order" class="select">
          <option value="random">Willekeurig</option>
          <option value="az">A‚ÄìZ op vraag</option>
        </select>

        <div class="h2" style="margin-top:10px">Overzicht</div>
        <div class="muted" id="statLine">Vragen: 0 ‚Ä¢ Score: 0/0</div>
      </aside>
    </div>
  </main>

  <!-- PASTE MODAL (simpel) -->
  <dialog id="pasteDlg" style="border:1px solid var(--border);border-radius:12px;padding:0;background:var(--panel);color:var(--text);max-width:720px;width:94%">
    <form method="dialog" style="padding:12px">
      <div class="h2">Plak je JSON</div>
      <p class="muted" style="margin-top:6px">Formaat: [{"text":"‚Ä¶","options":["A","B","C","D"],"correctIndex":1,"tags":["‚Ä¶"]}, ‚Ä¶]</p>
      <textarea id="pasteArea" class="textarea" rows="10" placeholder='[{"text":"..."}]'></textarea>
      <div class="toolbar" style="margin-top:8px;justify-content:flex-end">
        <button id="btnLoadPasted" class="btn">Laden</button>
        <button class="btn">Sluiten</button>
      </div>
    </form>
  </dialog>

<script>
/* ===== Theme toggle ===== */
(() => {
  const body=document.body, light=document.getElementById('light'), dark=document.getElementById('dark');
  function set(t){ body.classList.toggle('light', t==='light'); light.setAttribute('aria-pressed', t==='light'); dark.setAttribute('aria-pressed', t==='dark'); localStorage.setItem('rc_theme', t); }
  set(localStorage.getItem('rc_theme')||'dark');
  light.addEventListener('click',()=>set('light'));
  dark.addEventListener('click',()=>set('dark'));
})();

/* ===== Helpers ===== */
const $=(s,r=document)=>r.querySelector(s);
const esc=s=>String(s).replace(/[&<>\"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]||m));
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}};

/* ===== Elements ===== */
const el={
  qText:$('#qText'), optList:$('#optList'),
  resTitle:$('#resTitle'), resDetail:$('#resDetail'), btnExplain:$('#btnExplain'),
  progressLabel:$('#progressLabel'), fill:$('#fill'), tagLabel:$('#tagLabel'),
  status:$('#status'), btnCheck:$('#btnCheck'), btnNext:$('#btnNext'), btnPracticeWrong:$('#btnPracticeWrong'),
  fileJSON:$('#fileJSON'), btnPaste:$('#btnPaste'), pasteDlg:$('#pasteDlg'), pasteArea:$('#pasteArea'), btnLoadPasted:$('#btnLoadPasted'),
  chipBox:$('#chipBox'), search:$('#search'), order:$('#order'), statLine:$('#statLine')
};

/* ===== State ===== */
let ALL=[], VIEW=[], WRONG=[], idx=0, selected=null, checked=false, activeTag=null, searchTerm='', orderMode='random';
const LETTERS=['A','B','C','D'];

/* ===== Score in localStorage ===== */
function loadScore(){ try{ return {a:+(localStorage.getItem('rc_ans')||0), c:+(localStorage.getItem('rc_cor')||0)} }catch(e){ return {a:0,c:0} } }
function saveScore(addA=0,addC=0){ try{ const s=loadScore(); localStorage.setItem('rc_ans', String(s.a+addA)); localStorage.setItem('rc_cor', String(s.c+addC)); }catch(e){} }

/* ===== Normalize JSON ===== */
function normalize(arr){
  return (arr||[]).map(q=>{
    const id=q.id||Math.random().toString().slice(2);
    const text=(q.text||'').trim();
    const opts=(q.options||[q.optionA,q.optionB,q.optionC,q.optionD]).filter(x=>x!=null).map(x=>String(x).trim());
    const ci=Math.max(0,Math.min(3,Number.isFinite(+q.correctIndex)?+q.correctIndex:0));
    const explanation=(q.explanation||'').trim();
    const source=(q.source||'').trim();
    const tags=Array.isArray(q.tags)?q.tags:(typeof q.tags==='string'?q.tags.split(',').map(s=>s.trim()).filter(Boolean):[]);
    if(!text||opts.length!==4) return null;
    return {id,text,options:opts,correctIndex:ci,explanation,source,tags};
  }).filter(Boolean);
}

/* ===== Build UI ===== */
function setQuestions(arr,msg){
  ALL=normalize(arr); WRONG=[]; idx=0; selected=null; checked=false;
  buildTags(); buildView(); el.status.textContent=`Status: ${msg} (${ALL.length} vragen)`;
}
function buildTags(){
  const tags=Array.from(new Set(ALL.flatMap(q=>q.tags||[]))).sort((a,b)=>a.localeCompare(b));
  el.chipBox.innerHTML='';
  const mk=(label,tag=null)=>{ const b=document.createElement('button'); b.className='chip'+((activeTag===tag)?' active':''); b.textContent=label; b.onclick=()=>{ activeTag=tag; buildView(); buildTags(); }; el.chipBox.appendChild(b); };
  mk('Alle',null); tags.forEach(t=>mk(t,t));
}
function buildView(){
  VIEW=ALL.filter(q=>{
    const tagOk=!activeTag||(q.tags||[]).map(t=>t.toLowerCase()).includes(activeTag?.toLowerCase());
    const termOk=!searchTerm||q.text.toLowerCase().includes(searchTerm)||q.options.some(o=>o.toLowerCase().includes(searchTerm));
    return tagOk && termOk;
  });
  if(orderMode==='az') VIEW.sort((a,b)=>a.text.localeCompare(b.text)); else shuffle(VIEW);
  idx=0; selected=null; checked=false; WRONG=[];
  renderStats(); renderQuestion();
  const fInfo=(activeTag||searchTerm)?` ‚Ä¢ Gefilterd: ${VIEW.length}`:'';
  const s=loadScore(); el.statLine.textContent=`Vragen: ${ALL.length}${fInfo} ‚Ä¢ Score: ${s.c}/${s.a}`;
  el.btnPracticeWrong.disabled=true;
  el.resTitle.textContent=''; el.resDetail.textContent=''; el.btnExplain.style.display='none';
}
function renderStats(){
  el.progressLabel.textContent=`Vraag ${Math.min(idx+1,VIEW.length)}/${VIEW.length||0}`;
  const pct=VIEW.length?Math.round((idx/VIEW.length)*100):0; el.fill.style.width=pct+'%';
}
function renderQuestion(){
  const q=VIEW[idx];
  el.qText.textContent=q?q.text:'‚Äî';
  el.tagLabel.textContent=q&&q.tags&&q.tags.length?q.tags.join(' ‚Ä¢ '):'';
  el.optList.innerHTML='';
  el.resTitle.textContent=''; el.resDetail.textContent=''; el.btnExplain.style.display='none';

  if(!q){ el.btnCheck.disabled=true; el.btnNext.disabled=true; return; }

  q.options.forEach((opt,i)=>{
    const div=document.createElement('div');
    div.className='option'+(selected===i?' selected':'')+(checked&&i===q.correctIndex?' correct':'')+(checked&&selected===i&&i!==q.correctIndex?' wrong':'');
    const bullet=document.createElement('div'); bullet.className='opt-bullet'; bullet.textContent=LETTERS[i];
    const text=document.createElement('div'); text.className='opt-text'; text.textContent=opt;
    div.appendChild(bullet); div.appendChild(text);
    div.onclick=()=>{ if(!checked){ selected=i; renderQuestion(); el.btnCheck.disabled=false; } };
    el.optList.appendChild(div);
  });

  el.btnCheck.disabled=(selected==null)||checked;
  el.btnNext.disabled=!checked;
}

/* ===== Interactie ===== */
el.btnCheck.addEventListener('click',()=>{
  const q=VIEW[idx]; if(!q||selected==null||checked) return;
  checked=true;
  const ok=(selected===q.correctIndex);
  if(!ok) WRONG.push(q.id);
  saveScore(1,ok?1:0);

  // Feedback (direct zichtbaar, zonder layout-shift)
  el.resTitle.textContent= ok ? 'Goed! ‚úÖ' : 'Fout ‚ùå';
  el.resDetail.textContent= `Juiste antwoord: ${['A','B','C','D'][q.correctIndex]} ‚Äî ${q.options[q.correctIndex]}`;
  if(q.explanation || q.source){
    el.btnExplain.style.display='inline-block';
    el.btnExplain.onclick=()=>{
      const txt=(q.explanation?esc(q.explanation):'')+(q.source?`<br><br><strong>Bron:</strong> ${esc(q.source)}`:'');
      alert(txt||'Geen toelichting beschikbaar.');
    };
  }

  renderQuestion(); renderStats();
  el.btnPracticeWrong.disabled = WRONG.length===0;
});
el.btnNext.addEventListener('click',()=>{ if(!checked) return; if(idx+1<VIEW.length){ idx++; selected=null; checked=false; renderQuestion(); renderStats(); } });
el.btnPracticeWrong.addEventListener('click',()=>{
  const set=new Set(WRONG); VIEW=ALL.filter(q=>set.has(q.id));
  idx=0; selected=null; checked=false; WRONG=[];
  renderQuestion(); renderStats(); el.btnPracticeWrong.disabled=true;
  const s=loadScore(); el.statLine.textContent=`Vragen: ${ALL.length} ‚Ä¢ Fouten: ${VIEW.length} ‚Ä¢ Score: ${s.c}/${s.a}`;
});

/* ===== Import / Plak ===== */
el.fileJSON.addEventListener('change',async e=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const text=await f.text();
    const data=JSON.parse(text);
    const norm=normalize(Array.isArray(data)?data:[]);
    if(!norm.length) throw new Error('JSON bevatte geen geldige vragen.');
    setQuestions(norm,'JSON-bestand geladen');
  }catch(err){ alert(err.message||String(err)); }
  e.target.value='';
});
el.btnPaste.addEventListener('click',()=>el.pasteDlg.showModal());
el.btnLoadPasted.addEventListener('click',e=>{
  e.preventDefault();
  try{
    const data=JSON.parse(el.pasteArea.value);
    const norm=normalize(Array.isArray(data)?data:[]);
    if(!norm.length) throw new Error('JSON bevatte geen geldige vragen.');
    setQuestions(norm,'JSON geplakt en geladen');
    el.pasteArea.value=''; el.pasteDlg.close();
  }catch(err){ alert(err.message||String(err)); }
});
el.order.addEventListener('change',()=>{ orderMode=el.order.value; buildView(); });
el.search.addEventListener('input',()=>{ searchTerm=el.search.value.trim().toLowerCase(); buildView(); });
document.getElementById('btnResetScore').addEventListener('click',()=>{ try{ localStorage.setItem('rc_ans','0'); localStorage.setItem('rc_cor','0'); }catch(e){} const s=loadScore(); el.statLine.textContent=`Vragen: ${ALL.length} ‚Ä¢ Score: ${s.c}/${s.a}`; });

/* ===== Voorbeeld (tot JSON is ge√Ømporteerd) ===== */
setQuestions([
  {"id":"demo1","text":"Scenario: 75e minuut. Met hoeveel spelers moet een team minimaal zijn om door te mogen spelen?","options":["6","7","8","9"],"correctIndex":1,"tags":["aantal spelers"]},
  {"id":"demo2","text":"Mag je direct scoren uit een indirecte vrije schop in het doel van de tegenstander?","options":["Ja","Nee, niet direct.","Alleen in eigen doel.","Alleen met toestemming van de scheidsrechter."],"correctIndex":1,"tags":["indirecte vrije schop","scoren uit hervatting"]}
],"Voorbeeldvragen geladen");
</script>
</body>
</html>